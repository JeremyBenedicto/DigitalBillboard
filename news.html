<!DOCTYPE html>
<html lang="tl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Client Satisfaction Measurement (CSM) Form</title>

  <!-- Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body {
      font-family: "Arial", sans-serif;
      background: #f9f9f9;
      color: #000;
      margin: 0;
      padding: 0;
      font-size: 16px;
    }

    .container {
      max-width: 950px;
      background: #fff;
      margin: 30px auto;
      padding: 40px 60px;
      border: 1px solid #ccc;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    header {
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      margin-bottom: 30px;
      line-height: 1.4;
      position: relative;
    }

    header img {
      position: absolute;
      left: 20px;
      top: 5px;
      width: 70px;
      height: 70px;
      object-fit: contain;
    }

    header h2 { font-size: 20px; margin: 0; font-weight: bold; }
    header h3 { font-size: 18px; margin: 0; }

    .divider {
      border-bottom: 1px solid #000;
      margin: 15px 0;
    }

    h4.section-title {
      text-align: center;
      font-weight: bold;
      text-transform: uppercase;
      margin-top: 30px;
      margin-bottom: 15px;
    }

    p.instructions { text-align: justify; font-size: 16px; }

    .form-section { margin-top: 20px; }

    label { font-weight: 600; }

    .form-group { margin-bottom: 12px; }

    .inline-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    input[type="text"],
    input[type="date"],
    input[type="number"],
    textarea {
      border: 1px solid #ccc;
      padding: 6px 10px;
      width: 100%;
      border-radius: 4px;
    }

    textarea { min-height: 80px; resize: vertical; }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 15px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
      font-size: 15px;
      vertical-align: middle;
    }

    th { background-color: #efefef; }
    .question { text-align: left; font-weight: normal; }
    .emoji { font-size: 28px; display: block; }

    .red { color: #e74c3c; }
    .orange { color: #e67e22; }
    .gray { color: #7f8c8d; }
    .lightgreen { color: #2ecc71; }
    .green { color: #27ae60; }
    .na { color: #95a5a6; }
    .grayscale { filter: grayscale(100%); }

    .submit-btn {
      display: block;
      margin: 30px auto 10px;
      padding: 10px 30px;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
    }

    .submit-btn:hover { background-color: #0056b3; }

    .footer {
      text-align: center;
      margin-top: 20px;
      font-weight: bold;
    }

    .page-break {
      page-break-before: always;
      margin-top: 50px;
    }

    #overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      color: white;
      font-size: 22px;
      text-align: center;
      z-index: 9999;
      align-items: center;
      justify-content: center;
    }

    #overlay p {
      background: rgba(0,0,0,0.8);
      padding: 20px 40px;
      border-radius: 10px;
    }

    .back-button {
      position: fixed;
      top: 15px;
      left: 15px;
      z-index: 1000;
      padding: 10px 15px;
      background-color: #dcdada;
      color: #333;
      border: 1px solid #ccc;
      border-radius: 20px;
      text-decoration: none;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      transition: background-color 0.2s, transform 0.1s;
      font-size: 14px;
    }

    .back-button:hover {
      background-color: #e0e0e0;
      transform: translateY(-1px);
    }

    .back-button:active { transform: translateY(0); }
  </style>
</head>

<body>
  <a href="/index.html" class="back-button" onclick="window.history.back(); return false;">&larr;</a>

  <div id="overlay"><p>üìÑ Downloading PDF... Please wait.</p></div>

  <!-- PAGE 1 -->
  <div class="container" id="page1">
    <header>
      <div style="width:100%">
        <h3>Republic of the Philippines</h3>
        <h3>PROVINCE OF NUEVA ECIJA</h3>
        <h3>Municipality of Gabaldon</h3>
        <p><b>- oOo -</b></p>
        <h2>PAMBAYANG TANGGAPAN NG TAGATALA</h2>
      </div>
    </header>

    <div class="divider"></div>
    <h4>TULUNGAN MO KAMI MAS MAPABUTI ANG AMING MGA PROSESO AT SERBISYO!</h4>

    <p class="instructions">
      Ang Client Satisfaction Measurement (CSM) ay naglalayong masubaybayan ang karanasan ng taumbayan hinggil sa kanilang pakikitransaksyon sa mga tanggapan ng gobyerno.
      Makatutulong ang inyong kasagutan upang mas mapabuti at lalong mapahusay ang aming serbisyo publiko.
      Ang inyong ibinahaging impormasyon ay mananatiling kumpidensyal.
    </p>

    <div class="form-section">
      <div class="form-group inline-group">
        <label>Uri ng Kliyente:</label>
        <label><input type="checkbox"> Mamamayan</label>
        <label><input type="checkbox"> Negosyo</label>
        <label><input type="checkbox"> Gobyerno</label>
      </div>

      <div class="form-group inline-group">
        <label>Petsa:</label> <input type="date">
        <label>Kasarian:</label>
        <label><input type="checkbox"> Lalaki</label>
        <label><input type="checkbox"> Babae</label>
        <label>Edad:</label> <input type="number" min="1" style="width:80px">
      </div>

      <div class="form-group inline-group">
        <label>Rehiyon:</label> <input type="text">
        <label>Uri ng transaksyon o serbisyo:</label> <input type="text">
      </div>
    </div>

    <h4 class="section-title">Citizen‚Äôs Charter (CC)</h4>
    <p class="instructions">Lagyan ng tsek (‚úî) ang angkop na sagot.</p>

    <div class="form-section">
      <label>CC1. Alin sa mga sumusunod ang naglalarawan sa iyong kaalaman sa CC?</label>
      <div class="checkbox-group">
        <label><input type="checkbox"> Alam ko ang CC at nakita ko ito sa napuntahang opisina</label>
        <label><input type="checkbox"> Alam ko ang CC pero hindi ko ito nakita sa opisina</label>
        <label><input type="checkbox"> Nalaman ko ang CC nang makita ko ito sa opisina</label>
        <label><input type="checkbox"> Hindi ko alam kung ano ang CC at wala akong nakita sa opisina</label>
      </div>
    </div>
  </div>

  <!-- PAGE 2 -->
  <div class="container page-break" id="page2">
    <h4 class="section-title">Satisfaction Questions (SQD0‚Äì8)</h4>
    <p class="instructions">Pumili ng isang emoji na pinakaangkop sa iyong sagot.</p>

    <table id="emojiTable">
      <thead>
        <tr>
          <th class="question">Mga Pahayag</th>
          <th><span class="emoji red">üò†</span>Lubos na<br>hindi sumasang-ayon</th>
          <th><span class="emoji orange">üôÅ</span>Hindi<br>sumasang-ayon</th>
          <th><span class="emoji gray">üòê</span>Walang<br>kinikilingan</th>
          <th><span class="emoji lightgreen">üôÇ</span>Sumasang-ayon</th>
          <th><span class="emoji green">üòÉ</span>Labis na<br>sumasang-ayon</th>
          <th><span class="emoji na">üö´</span>N/A</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="form-section">
      <label>Mga suhestiyon (opsyonal):</label>
      <textarea></textarea>
      <label>Email address (opsyonal):</label>
      <input type="text">
    </div>

    <button class="submit-btn" onclick="savePDF()">Isumite</button>

    <div class="footer">MARAMING</div>
  </div>

  <script>
    // Dynamically create table questions
    const questions = [
      "Nasiyahan ako sa serbisyo na aking natanggap sa napuntahan na tanggapan.",
      "Makatwiran ang oras na aking ginugol para sa pagproseso ng aking transaksyon.",
      "Ang opisina ay sumusunod sa mga kinakailangang dokumento at mga hakbang batay sa impormasyong ibinigay.",
      "Ang mga hakbang sa pagproseso, kasama na ang pagbayad ay madali at simple lamang.",
      "Mabilis at madali akong nakahanap ng impormasyon tungkol sa aking transaksyon mula sa opisina o sa website nito.",
      "Nagbayad ako ng makatwirang halaga para sa aking transaksyon. (Kung libre, lagyan ng tsek ang N/A.)",
      "Pakiramdam ko ay patas ang opisina sa lahat, o ‚Äúwalang palakasan‚Äù, sa aking transaksyon.",
      "Magalang akong trinato ng mga tauhan, at (kung humingi ako ng tulong) alam ko na sila ay handang tumulong sa akin.",
      "Nakuha ko ang kinakailangan ko mula sa tanggapan ng gobyerno; kung tinanggihan man, ito ay sapat na ipinaliwanag sa akin."
    ];

    const tbody = document.querySelector("#emojiTable tbody");
    questions.forEach((q, i) => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td class="question">SQD${i}. ${q}</td>
        ${Array.from({ length: 6 }, (_, j) => `<td><input type="radio" name="sqd${i}" value="${j+1}"></td>`).join("")}
      `;
      tbody.appendChild(row);
    });

    // ‚úÖ FIXED savePDF() ‚Äî Android-compatible
    async function savePDF() {
      const PDF_RENDER_SCALE = 2.5;
      const { jsPDF } = window.jspdf;
      const overlay = document.getElementById("overlay");
      const button = document.querySelector(".submit-btn");
      const pdf = new jsPDF("p", "mm", "a4");

      const pageHeight = pdf.internal.pageSize.getHeight();
      const pageWidth = pdf.internal.pageSize.getWidth();

      overlay.style.display = "flex";
      button.style.display = "none";

      document.querySelectorAll(".emoji").forEach(e => e.classList.add("grayscale"));
      await new Promise(r => setTimeout(r, 600));

      const page1 = document.getElementById("page1");
      const page2 = document.getElementById("page2");

      const canvas1 = await html2canvas(page1, { scale: PDF_RENDER_SCALE, useCORS: true });
      const canvas2 = await html2canvas(page2, { scale: PDF_RENDER_SCALE, useCORS: true });

      const img1 = canvas1.toDataURL("image/png");
      const img2 = canvas2.toDataURL("image/png");

      pdf.addImage(img1, "PNG", 0, 0, pageWidth, pageHeight);
      pdf.addPage();
      pdf.addImage(img2, "PNG", 0, 0, pageWidth, pageHeight);

      // ‚úÖ Android-safe download
      const blob = pdf.output("blob");
      const blobUrl = URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.href = blobUrl;
      link.download = "Client_Satisfaction_Form.pdf";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);

      setTimeout(() => URL.revokeObjectURL(blobUrl), 5000);

      document.querySelectorAll(".emoji").forEach(e => e.classList.remove("grayscale"));
      overlay.style.display = "none";
      button.style.display = "block";
    }
  </script>
</body>
</html>
